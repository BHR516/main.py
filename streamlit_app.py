import streamlit as st
import pandas as pd
import plotly.express as px
import time

# 1. ุฅุนุฏุงุฏุงุช ุงููููุฉ ุงูุจุตุฑูุฉ ูููููุน
st.set_page_config(page_title="ุงูุจุญุฑูู ุชุฏููุฑ | Bahrain Recycle", page_icon="๐ง๐ญ", layout="wide")

# 2. ุฅุถุงูุฉ CSS ูุชูุณูู ุงููุงุฌูุฉ ูุงูุชุทุจููุงุช ุงูุญุฏูุซุฉ
st.markdown("""
    <style>
    .stApp { background-color: #f8fafc; }
    .main-header { font-size: 3rem; color: #15803d; text-align: center; font-weight: bold; margin-bottom: 10px; }
    .card { background-color: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); border-bottom: 4px solid #15803d; }
    .stat-text { font-size: 1.2rem; color: #475569; }
    </style>
    """, unsafe_allow_html=True)

# 3. ุงูููุฏุฑ ููุงุฆูุฉ ุงูุชูุงุนู
st.markdown('<div class="main-header">๐ง๐ญ ููุตุฉ ุชุฏููุฑ ุงูุจุญุฑูู ุงูุฐููุฉ</div>', unsafe_allow_html=True)
st.write("<p style='text-align: center;'>ุณุงูู ูู ุญูุงูุฉ ุจูุฆุฉ ููููุชูุง ูุงูุณุจ ููุงุทุงู ููุงุจู ูู ุนูููุฉ ุชุฏููุฑ</p>", unsafe_allow_html=True)

# 4. ููุญุฉ ุฅุญุตุงุฆูุงุช ุชูุงุนููุฉ (Dashboard)
st.divider()
col1, col2, col3, col4 = st.columns(4)
with col1:
    st.metric("ุญุงููุงุช ูุดุทุฉ", "128", "+5")
with col2:
    st.metric("ูุณุชุฎุฏููู ูุดุทูู", "1,240", "12%")
with col3:
    st.metric("ุฃุทูุงู ูุฏูุฑุฉ (ุดูุฑ ูุจุฑุงูุฑ)", "42.5", "+2.1")
with col4:
    st.metric("ููุงุท ุงููุฌุชูุน", "85,000", "๐ฅ")

# 5. ูุธุงู ุงูููุงูุขุช ุงูุชูุงุนูู (Gamification)
st.sidebar.markdown("### ๐ ูุงุฏู ุฃุตุฏูุงุก ุงูุจูุฆุฉ")
user_name = st.sidebar.text_input("ุณุฌู ุฏุฎููู ุจุงุณูู ูุฌูุน ุงูููุงุท:", "ุฒุงุฆุฑ")
points = st.sidebar.slider("ููุงุทู ุงูุญุงููุฉ:", 0, 1000, 450)
st.sidebar.progress(points / 1000)
st.sidebar.caption(f"ุจุงูู {1000 - points} ููุทุฉ ููุญุตูู ุนูู ูุณุงู ุงูุณููุฑ ุงูุจูุฆู!")

# 6. ุงูุฎุฑูุทุฉ ุงูุฐููุฉ ูุชูุงุตูู ุงูููุงูุน
data = {
    'ุงูููุทูุฉ': ['ุงูููุงูุฉ', 'ุงูุฑูุงุน', 'ุณุชุฑุฉ', 'ุงูุจุณูุชูู', 'ูุฏููุฉ ุญูุฏ', 'ุงูุญุฏ'],
    'ุงููููุน ุงูุชุญุฏูุฏู': ['ุจุงุจ ุงูุจุญุฑูู', 'ูุฑุจ ูุฏุฑุณุฉ ูุคูุคุฉ ุงูุฎููุฌ', 'ูุฑูุฒ ุณุชุฑุฉ ุงูุงุฌุชูุงุนู', 'ููุดู ุงูุจุณูุชูู', 'ุณูู ูุงูู', 'ุญุฏููุฉ ุงูุญุฏ'],
    'ููุน ุงูููุงูุงุช': ['ุฅููุชุฑูููุงุช/ุจูุงุณุชูู', 'ูุฑู ููุท', 'ุฒุฌุงุฌ/ูุนุฏู', 'ูุชุนุฏุฏ', 'ุจูุงุณุชูู', 'ูุฑู/ูุฑุชูู'],
    'lat': [26.2361, 26.1300, 26.1547, 26.2550, 26.1150, 26.2490],
    'lon': [50.5831, 50.5550, 50.6070, 50.6750, 50.5050, 50.6480],
    'ุงูุญูู ุงูุญุงูู': [80, 20, 45, 95, 10, 60] # ูุณุจุฉ ุงูุชูุงุก ุงูุญุงููุฉ
}
df = pd.DataFrame(data)

st.subheader("๐ ุงุจุญุซ ุนู ุฃูุฑุจ ุญุงููุฉ ูุชููุฏ ุญุงูุชูุง")
c1, c2 = st.columns([2, 1])

with c1:
    # ุฎุฑูุทุฉ ููููุฉ ุจูุงุกู ุนูู ูุณุจุฉ ุงูุชูุงุก ุงูุญุงููุฉ
    fig = px.scatter_mapbox(df, lat="lat", lon="lon", size="ุงูุญูู ุงูุญุงูู", color="ุงูุญูู ุงูุญุงูู",
                            color_continuous_scale=px.colors.sequential.Greens,
                            hover_name="ุงูููุทูุฉ", hover_data=["ุงููููุน ุงูุชุญุฏูุฏู", "ููุน ุงูููุงูุงุช"],
                            zoom=10, height=500)
    fig.update_layout(mapbox_style="carto-positron")
    st.plotly_chart(fig, use_container_width=True)

with c2:
    st.markdown('<div class="card">', unsafe_allow_html=True)
    st.write("### ๐ ุชูุงุตูู ุณุฑูุนุฉ")
    search = st.selectbox("ุงุฎุชุฑ ุงูููุทูุฉ ูุฑุคูุฉ ุงูุญุงูุฉ ุงููุจุงุดุฑุฉ:", df['ุงูููุทูุฉ'])
    selected = df[df['ุงูููุทูุฉ'] == search].iloc[0]
    
    st.write(f"**ุงููููุน:** {selected['ุงููููุน ุงูุชุญุฏูุฏู']}")
    st.write(f"**ุงูููุน:** {selected['ููุน ุงูููุงูุงุช']}")
    
    # ุดุฑูุท ุญุงูุฉ ูุงูุชูุงุก ุงูุญุงููุฉ
    fill_level = selected['ุงูุญูู ุงูุญุงูู']
    if fill_level > 80:
        st.error(f"ุญุงูุฉ ุงูุญุงููุฉ: ููุชูุฆุฉ ({fill_level}%)")
    else:
        st.success(f"ุญุงูุฉ ุงูุญุงููุฉ: ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ({fill_level}%)")
    
    if st.button("โ ููุฏ ููุช ุจุงูุชุฏููุฑ ููุง!"):
        with st.spinner('ุฌุงุฑู ุฅุถุงูุฉ ุงูููุงุท ููุณุชูุงู...'):
            time.sleep(1)
            st.balloons()
            st.success(f"ููู ูุง {user_name}! ุญุตูุช ุนูู 50 ููุทุฉ.")
    st.markdown('</div>', unsafe_allow_html=True)

# 7. ูุณู ุงูุชุจููุบุงุช ุงูุชูุงุนูู
st.divider()
st.subheader("๐ข ุฎุฏูุฉ ุงูููุงุทููู")
with st.expander("ูู ูุฌุฏุช ุญุงููุฉ ููุชูุฆุฉ ุฃู ููุณูุฑุฉุ ุงุถุบุท ููุง ููุชุจููุบ"):
    issue_type = st.radio("ููุน ุงููุดููุฉ:", ["ุงูุญุงููุฉ ููุชูุฆุฉ", "ุงูุญุงููุฉ ุชุงููุฉ", "ูููุน ุบูุฑ ุฏููู"])
    if st.button("ุฅุฑุณุงู ุงูุชูุฑูุฑ ููุฒุงุฑุฉ ุงูุจูุฏูุงุช"):
        st.toast("ุดูุฑุงู ูููุงุทูุชู ุงูุตุงูุญุฉ! ุชู ุฅุฑุณุงู ุงูุจูุงุบ ููุฌูุงุช ุงููุฎุชุตุฉ.")